<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script>
      window.onload = () => {
        class Box {
          constructor(x, y) {
            this.x = x;
            this.y = y;
            this.r = 255;
            this.g = 255;
            this.b = 255;
            this.horizon = 1;
            this.vertical = 1;
          }

          changeR(r) {
            this.r = r;
          }
          changeG(g) {
            this.g = g;
          }
          changeB(b) {
            this.b = b;
          }
          changeH() {
            this.horizon = 1 - this.horizon;
          }
          changeV() {
            this.vertical = 1 - this.vertical;
          }
          getX() {
            return this.x;
          }
          getY() {
            return this.y;
          }
          setX(x) {
            this.x = x;
          }
          setY(y) {
            this.y = y;
          }
        }

        const vpWidth = window.innerWidth;
        const vpHeight = window.innerHeight;

        const arr = Array(2);

        const effect = (x, y, r, g, b) => {
          const newElement = document.createElement('div');

          newElement.style.width = '150px';
          newElement.style.height = '150px';
          newElement.style.backgroundColor = `rgb(${r}, ${g}, ${b}, ${0.3})`;
          newElement.style.position = 'fixed';
          newElement.style.top = `${y}px`;
          newElement.style.left = `${x}px`;
          newElement.style.transition = `all 0.3s ease-out`;

          setTimeout(() => {
            newElement.style.opacity = '0';
            newElement.style.transform = 'scale(2)';

            setTimeout(() => {
              document.body.removeChild(newElement);
            }, 300);
          }, 30);

          document.body.appendChild(newElement);
        };

        const render = (x, y, index) => {
          const box = document.createElement('div');

          const boxObject = new Box(x, y);

          let squareX = 150;
          let squareY = 150;

          box.style.height = `${squareY}px`;
          box.style.width = `${squareX}px`;
          box.style.position = 'fixed';
          box.style.transition = 'background-color 0.3s ease';

          setInterval(() => {
            if (0 > x || x + squareX >= vpWidth) {
              boxObject.changeH();
              effect(x, y, boxObject.r, boxObject.g, boxObject.b);
            }
            if (0 > y || y + squareY >= vpHeight) {
              boxObject.changeV();
              effect(x, y, boxObject.r, boxObject.g, boxObject.b);
            }

            let acc = 5;
            let ratio = vpWidth / vpHeight;

            let dX = boxObject.horizon ? 1.5 : -1.5;
            let dY = boxObject.vertical ? 1 : -1;

            dX *= acc;
            dY *= acc;

            x += dX;
            y += dY;

            box.style.top = `${y}px`;
            box.style.left = `${x}px`;

            boxObject.setX(x);
            boxObject.setY(y);

            arr[index] = [x, y];
          }, 1000 / 60);

          setInterval(() => {
            boxObject.changeR(Math.floor(Math.random() * 255));
            boxObject.changeG(Math.floor(Math.random() * 255));
            boxObject.changeB(Math.floor(Math.random() * 255));

            box.style.backgroundColor = `rgb(${boxObject.r}, ${boxObject.g}, ${boxObject.b}, 0.3)`;
          }, 300);
          document.body.appendChild(box);
          return boxObject;
        };
        const box1 = render(0, 0, 0);
        const box2 = render(600, 400, 1);

        setInterval(() => {
          let diffX = Math.abs(box1.getX() - box2.getX());
          let diffY = Math.abs(box1.getY() - box2.getY());
          if (diffX < 150 && diffY < 150) {
            if (diffX < diffY) {
              box1.changeV();
              box2.changeV();
            } else {
              box1.changeH();
              box2.changeH();
            }
            effect(box1.x, box1.y, box1.r, box1.g, box1.b);
            effect(box2.x, box2.y, box2.r, box2.g, box2.b);
          }
        }, 1000 / 60);
      };
    </script>
  </head>
  <body></body>
</html>
